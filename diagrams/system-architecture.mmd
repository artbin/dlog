graph TB
    subgraph "Application Layer"
        APP[Application]
        BATUTA[üéº Batuta Language]
        QUERY[Query Engine]
    end
    
    subgraph "üî∫ Pyramid Nodes - Pyralog Cluster"
        subgraph "Shen Ring Layer - The One Ring ìç∂"
            SHEN[Shen Ring<br/>Unified Log Interface]
            
            subgraph "The Five Rings"
                ANKH[‚ò• Ankh Ring<br/>Consistent Hashing]
                SUNDIAL[‚≠ï Sundial Circle<br/>Gossip Membership]
                CARTOUCHE[ìçπìç∫ Cartouche Ring<br/>Token Coordination]
                OUROBOROS[üêç Ouroboros Circle<br/>Chain Replication]
            end
        end
        
        PYRAMID_RAFT[Raft Consensus<br/>Per Partition]
        PYRAMID_STORAGE[LSM Storage<br/>Segments & Indexes]
    end
    
    subgraph "üóø Obelisk Nodes - ‚òÄÔ∏è Pharaoh Network"
        OBELISK[Obelisk Nodes<br/>Crash-Safe Counters]
        OBELISK_SPARSE[Sparse Files<br/>Counter Storage]
        PHARAOH[Pharaoh Network<br/>Coordination Layer]
        SCARAB[ü™≤ Scarab IDs<br/>Unique Identifiers]
    end
    
    subgraph "Pyramid Storage Layer"
        LSM[LSM Tree]
        SEGMENTS[Segments]
        INDEX[Indexes]
        PPHM[PPHM Indexes]
        TIERED[Tiered Storage<br/>S3/GCS/Azure]
    end
    
    subgraph "Consensus & Replication"
        RAFT[Raft Consensus]
        QUORUM[Flexible Quorums]
        COPYSET[CopySet Replication]
    end
    
    subgraph "Actor System"
        ACTORS[Location-Transparent Actors]
        SUPERVISION[Supervision Trees]
        TOPOLOGY[Topology-Level Reactivity]
    end
    
    %% Application to Shen Ring
    APP --> BATUTA
    BATUTA --> QUERY
    QUERY --> SHEN
    
    %% Shen Ring to Five Rings
    SHEN --> ANKH
    SHEN --> SUNDIAL
    SHEN --> CARTOUCHE
    SHEN --> OUROBOROS
    
    %% Five Rings to Coordination
    ANKH --> SCARAB
    SUNDIAL --> PHARAOH
    CARTOUCHE --> PHARAOH
    OUROBOROS --> OBELISK
    
    %% Pyramid internals
    SHEN --> PYRAMID_RAFT
    SHEN --> PYRAMID_STORAGE
    PYRAMID_RAFT --> LSM
    PYRAMID_STORAGE --> LSM
    
    %% Pyramid requests from Pharaoh Network
    SHEN -->|Request IDs| OBELISK
    OBELISK --> OBELISK_SPARSE
    OBELISK_SPARSE -->|Generate| SCARAB
    
    %% Storage internals
    LSM --> SEGMENTS
    LSM --> INDEX
    LSM --> PPHM
    SEGMENTS --> TIERED
    
    %% Consensus
    RAFT --> QUORUM
    QUORUM --> COPYSET
    COPYSET --> OUROBOROS
    
    %% Actor integration
    QUERY --> ACTORS
    ACTORS --> SUPERVISION
    SUPERVISION --> TOPOLOGY
    TOPOLOGY --> SHEN
    
    %% Styling
    classDef primitive fill:#4A90E2,stroke:#2E5C8A,color:#fff
    classDef obelisk_storage fill:#8B4513,stroke:#5D2E0C,color:#fff
    classDef pyramid_storage fill:#7CB342,stroke:#558B2F,color:#fff
    classDef consensus fill:#F57C00,stroke:#E65100,color:#fff
    classDef application fill:#9C27B0,stroke:#6A1B9A,color:#fff
    classDef ring fill:#FFD700,stroke:#FFA000,color:#000
    
    class OBELISK,PHARAOH,SCARAB primitive
    class OBELISK_SPARSE obelisk_storage
    class LSM,SEGMENTS,INDEX,PPHM,TIERED,PYRAMID_STORAGE,PYRAMID_RAFT pyramid_storage
    class RAFT,QUORUM,COPYSET consensus
    class APP,BATUTA,QUERY,ACTORS,SUPERVISION,TOPOLOGY application
    class SHEN,ANKH,SUNDIAL,CARTOUCHE,OUROBOROS ring

